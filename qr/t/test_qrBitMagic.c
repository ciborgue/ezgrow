/* $Id: test_qrBitMagic.c 657 2013-04-13 03:42:40Z  $ */
#include <stdio.h>
#include <sys/types.h>
#include <assert.h>

#include "qrBitMagic.h"

/* TODO add v2 test cases */

static struct {
    int ver,x,y,bytes;
    u_int8_t    data[128];
} data[] = {
    {0, 0, 0, 63, {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10 }},
    {0, 20, 20, 63, {
        0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }},
    {0, 0, 20, 63, {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00 }},
    {0, 20, 0, 63, {
        0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }},
    {0, 0, 0, -1, { 0x00 }}
};

int main(int argc, char *argv[]) {
    hint_t       hint;
    int         i0,i1;
    u_int8_t    mtrx[16384];

    printf("Testing BitMagic ");
    for (i0 = 0; data[i0].bytes != -1; i0++) {
        hint.ver = data[i0].ver;
        for (i1 = 0; i1 < 16384; i1++) {
            mtrx[i1] = 0;
        }
        qrSetMod(hint,data[i0].x,data[i0].y,1,mtrx);
        for (i1 = 0; i1 < data[i0].bytes; i1++) {
            assert(mtrx[i1] == data[i0].data[i1]);
        }
        printf(".");
        qrXorMod(hint,data[i0].x,data[i0].y,1,mtrx);
        for (i1 = 0; i1 < data[i0].bytes; i1++) {
            assert(mtrx[i1] == 0);
        }
        printf(".");
        qrSetMod(hint,data[i0].x,data[i0].y,1,mtrx);
        for (i1 = 0; i1 < data[i0].bytes; i1++) {
            assert(mtrx[i1] == data[i0].data[i1]);
        }
        printf(".");

        for (i1 = 0; i1 < 16384; i1++) {
            mtrx[i1] = 0xff;
        }
        qrSetMod(hint,data[i0].x,data[i0].y,0,mtrx);
        for (i1 = 0; i1 < data[i0].bytes; i1++) {
            assert(mtrx[i1] == ((~data[i0].data[i1]) & 0xff));
        }
        printf(".");
        qrXorMod(hint,data[i0].x,data[i0].y,1,mtrx);
        for (i1 = 0; i1 < data[i0].bytes; i1++) {
            assert(mtrx[i1] == 0xff);
        }
        printf(".");
    }
    printf(" done\n");
    return 0;
}
